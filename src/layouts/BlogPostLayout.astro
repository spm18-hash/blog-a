---
import BaseLayout from "./BaseLayout.astro";
import { blogSchema } from "../content.config";
import { z } from "astro/zod";
import { Image } from "astro:assets";
import Pill from "../components/Pill.astro";
import Toc from "../components/ToC.astro";
import type { MarkdownHeading } from "astro";

type Props = z.infer<ReturnType<typeof blogSchema>> & {
    headings: MarkdownHeading[];
};

const {
    title,
    description,
    publishDate,
    image,
    imageAlt,
    tags,
    authors,
    headings,
} = Astro.props;
---

<BaseLayout pageTitle={title}>
    <header class="space-y-4 mb-10 max-w-5xl">
        <time
            class="font-medium inline-flex text-xs text-neutral-900 px-2 py-0.5 rounded-full border border-neutral-900"
            datetime={publishDate.toISOString()}
        >
            {
                publishDate.toLocaleDateString("en-IN", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                })
            }
        </time>
        <h1
            class="text-gray-900 text-pretty text-4xl lg:text-5xl font-semibold tracking-tight capitalize leading-tight"
        >
            {title}
        </h1>
        <p class="text-lg text-pretty sm:text-xl text-gray-950">
            {description}
        </p>
    </header>
    <Image
        src={image}
        alt={imageAlt}
        format="avif"
        loading={"eager"}
        widths={[380, 720, 1216]}
        sizes={"90vw"}
        priority
        class="w-full max-w-304 h-auto aspect-3/2"
    />
    <div class="flex items-center justify-between my-6">
        <p class="text-sm">
            Written by&nbsp;
            <span class="inline-flex flex-wrap gap-2">
                {
                    authors.map((author) => (
                        <Pill
                            classes="text-sm"
                            href={`/authors/${author}`}
                            text={author}
                        />
                    ))
                }
            </span>
        </p>
        <div class="max-sm:hidden flex max-sm:flex-wrap ml-auto gap-2">
            {
                tags.map((tag) => (
                    <Pill classes="text-sm" href={`/tags/${tag}`} text={tag} />
                ))
            }
        </div>
    </div>

    <div class="flex max-md:flex-col gap-24">
        <aside class="flex-1 lg:sticky lg:top-1 h-fit bg-white">
            <Toc headings={headings} levels={3} />
        </aside>
        <article class="prose">
            <slot />
        </article>
    </div>
</BaseLayout>
