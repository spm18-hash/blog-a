---
import type { Page } from "astro";
import type { HTMLAttributes } from "astro/types";
import { collapseRange } from "../helpers/paginate";
import type { CollectionEntry } from "astro:content";
import ArrowLeftIcon from "../assets/icons/arrow-left.svg";
import ArrowRightIcon from "../assets/icons/arrow-right.svg";

export type Props = Omit<HTMLAttributes<"nav">, "slot"> & {
    page: Page<CollectionEntry<"blog">>;
    allPages: string[];
};

const {
    page,
    allPages,
    "aria-label": ariaLabel = "Pagination",
    ...attrs
} = Astro.props;

const pages = allPages.map((href, i) => {
    return { pageNum: i + 1, text: String(i + 1), href };
});

const collapsedPages = collapseRange(page, pages);
---

<nav>
    <ul class="my-20 flex w-full justify-center items-center gap-4">
        {
            page.url.prev && (
                <li class="prev rounded-xl border border-blue-400 transition-colors duration-150">
                    <a
                        href={page.url.prev}
                        class="flex size-10 items-center justify-center"
                    >
                        <span class="sr-only">
                            Go to page {page.currentPage - 1} of {page.lastPage}
                        </span>
                        <ArrowLeftIcon class="size-4" />
                    </a>
                </li>
            )
        }

        {
            collapsedPages.map((link) => (
                <li class="hidden sm:inline-block">
                    {!link.href ? (
                        <p>{link.text}</p>
                    ) : (
                        <a
                            href={link.href}
                            class:list={[
                                "relative flex size-10 items-center justify-center rounded-xl border border-transparent transition-colors duration-150",
                                link.pageNum !== page.currentPage &&
                                    "hover:border-gray-950 focus:border-gray-950",
                            ]}
                            aria-current={
                                link.pageNum === page.currentPage
                                    ? "page"
                                    : undefined
                            }
                        >
                            {link.pageNum}
                        </a>
                    )}
                </li>
            ))
        }
        <li class="sm:hidden text-sm">
            <p aria-current="page">
                Page {page.currentPage} of {page.lastPage}
            </p>
        </li>
        {
            page.url.next && (
                <li class="next rounded-xl border border-blue-400 transition-colors duration-150">
                    <a
                        href={page.url.next}
                        class="flex size-10 items-center justify-center"
                    >
                        <span class="sr-only">
                            Go to page {page.currentPage - 1} of {page.lastPage}
                        </span>
                        <ArrowRightIcon class="size-4" />
                    </a>
                </li>
            )
        }
    </ul>
</nav>

<style>
    .next:hover,
    .prev:hover {
        background: linear-gradient(
            247.23deg,
            hsl(200 100% 90% / 0.5) 0%,
            hsl(200 100% 90% / 0.5) 100%
        );
    }
    @media screen and (min-width: 640px) {
        [aria-current="page"]::before {
            position: absolute;
            inset: 0;
            content: "";
            margin: -1px;
            border-radius: inherit;
            background: linear-gradient(
                247.23deg,
                hsl(200, 100%, 100%) 0%,
                hsl(200, 100%, 50%) 100%
            );
            z-index: -2;
        }
    }
    @media screen and (min-width: 640px) {
        [aria-current="page"]::after {
            position: absolute;
            z-index: -1;
            inset: 0;
            content: "";
            border-radius: inherit;
            background: rgb(35 38 45)
                linear-gradient(
                    247.23deg,
                    hsl(200, 100%, 50%) 0%,
                    hsl(200, 100%, 100%) 100%
                );
        }
    }
</style>
